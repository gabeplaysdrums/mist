<!DOCTYPE html>
<!--

  Dropbox upload demo based on:
  https://github.com/dropbox/dropbox-js/blob/stable/guides/getting_started.md

-->
<html>
  <head>
    <script src="//cdnjs.cloudflare.com/ajax/libs/dropbox.js/0.10.2/dropbox.min.js"></script>
    <script>

        function setup()
        {
            // MistStudio app key (https://www.dropbox.com/developers/apps/info/dj2e7jb5n7q6j60)
            var client = new Dropbox.Client({ key: "dj2e7jb5n7q6j60" });

            client.authenticate(function(error, client) {

                if (error)
                {
                    console.error("Error while authenticating: " + error);
                    return;
                }

                console.log("Authenticated successfully");

                var chooserElem = document.getElementById("chooser");

                chooserElem.addEventListener("change", function(e) {

                    var file = chooserElem.files[0];

                    var startDate = new Date();
                    console.log("Uploading files");

                    for (var i=0; i < 4; i++)
                    {
                        client.writeFile(file.name + "." + i, file, function(error, stat) {

                            if (error)
                            {
                                console.error("Error while writing file: " + error);
                                return;
                            }

                            console.log("File saved as revision " + stat.versionTag);

                            var elapsedMillis = new Date() - startDate;
                            console.log("Elapsed time: " + (elapsedMillis / 1000).toFixed(3) + " seconds.");
                        });
                    }

                }, false);

                chooserElem.disabled = false;
            });
        }

    </script>
  </head>
  <body onload="setup();">

    <p>
      Choose a file to upload:
      <input id="chooser" type="file" disabled />
    </p>

  </body>
</html>
